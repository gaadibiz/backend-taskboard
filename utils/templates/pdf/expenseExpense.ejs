<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Advance Expense Request</title>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 20px;
      font-size: 12px;
      color: #333;
    }

    h2 {
      text-align: center;
      margin-bottom: 20px;
      font-size: 20px;
      border-bottom: 3px solid #007BFF;
      padding-bottom: 5px;
    }

    .section {
      margin-top: 20px;
    }

    .section-title {
      font-size: 14px;
      font-weight: bold;
      color: #fff;
      background-color: #007BFF;
      padding: 8px 12px;
      border-radius: 4px 4px 0 0;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 0;
    }

    th, td {
      text-align: left;
      padding: 8px 10px;
      border: 1px solid #ccc;
    }

    th {
      background-color: #f1f1f1;
    }

    .two-column td {
      width: 50%;
    }

    .workflow-stage {
      margin-top: 10px;
      margin-bottom: 5px;
      font-weight: bold;
      font-size: 13px;
      color: #444;
      padding-left: 4px;
    }

    .timeline-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0 6px;
    }

    .timeline-table th {
      background-color: #e9ecef;
      font-size: 12px;
    }

    .timeline-table td {
      background-color: #fdfdfd;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      font-size: 11.5px;
    }

    .timeline-table td.status-approved {
      background-color: #d4edda;
      color: #155724;
      font-weight: bold;
    }

    .timeline-table td.status-pending {
      background-color: #fff3cd;
      color: #856404;
      font-weight: bold;
    }

    .timeline-table td.status-rejected {
      background-color: #f8d7da;
      color: #721c24;
      font-weight: bold;
    }

    .footer-note {
      margin-top: 20px;
      font-size: 11px;
      text-align: center;
      color: #777;
    }
  </style>
</head>
<body>

  <h2>Advance Expense Request</h2>

  <div class="section">
    <div class="section-title">Request Summary</div>
    <table class="two-column">
      <tr>
        <td><strong>Expense Type:</strong> <%= data.expense_type %></td>
        <td><strong>Expense Date:</strong> <%= data.expense_date %></td>
      </tr>
      <tr>
        <td><strong>Billing Company:</strong> <%= data.billing_company_name %></td>
        <td><strong>Project:</strong> <%= data.project_name %></td>
      </tr>
      <tr>
        <td><strong>Project Manager:</strong> <%= data.project_manager_name %></td>
        <td><strong>Finance Manager:</strong> <%= data.finance_manager_name %></td>
      </tr>
      <tr>
        <td><strong>Category:</strong> <%= data.expense_category_name %></td>
        <td><strong>Category Manager:</strong> <%= data.category_manager_name %></td>
      </tr>
      <tr>
        <td><strong>Merchant:</strong> <%= data.merchant %></td>
        <td><strong>Business Purpose:</strong> <%= data.business_purpose %></td>
      </tr>

      <tr>
        <td><strong>Advance Amount:</strong> ₹ <%= data.advance_amount %> </td>
        <td><strong>Rembursed Amount:</strong> ₹ <%= data.reimbursed_amount %> </td>
      </tr>
      <tr>
          <td><strong>Eligible reimbursed amount:</strong> ₹ <%= data.eligible_reimbursement_amount %></td>
        <td><strong>Actual reimbursed amount:</strong> ₹ <%= data.actual_reimbursed_amount %></td>
      </tr>
      <tr>
        <td><strong>is Deduct from advance:</strong> <%= data.is_deduct_from_advance? "Yes" : "No" %></td>
        <td><strong>Status:</strong> <%= data.status %></td>
    </tr>
      <tr>
        <td colspan="2"><strong>Description:</strong> <%= data.description %></td>
      </tr>
    </table>
  </div>

  <% if (data.user_details) { %>
  <div class="section">
    <div class="section-title">User Information</div>
    <table class="two-column">
      <tr>
        <td><strong>Full Name:</strong> <%= data.user_details.full_name %></td>
        <td><strong>Email:</strong> <%= data.user_details.email %></td>
      </tr>
      <tr>
        <td><strong>Role:</strong> <%= data.user_details.role_name %> (<%= data.user_details.role_value %>)</td>
        <td><strong>Job Title:</strong> <%= data.user_details.job_title %></td>
      </tr>
      <tr>
        <td><strong>Manager:</strong> <%= data.user_details.manager_name %></td>
        <td><strong>User Type:</strong> <%= data.user_details.user_type %></td>
      </tr>
      <tr>
        <td><strong>Department:</strong> <%= data.user_details.department_name %> / <%= data.user_details.department %></td>
        <td><strong>DOB:</strong> <%= data.user_details.date_of_birth %></td>
      </tr>
      <tr>
        <td><strong>Address:</strong> <%= data.user_details.street_address %>, <%= data.user_details.unit_or_suite %></td>
        <td><strong>City/State:</strong> <%= data.user_details.city %>, <%= data.user_details.province_or_state %></td>
      </tr>
      <tr>
        <td><strong>Postal Code:</strong> <%= data.user_details.postal_code %></td>
        <td><strong>Country:</strong> <%= data.user_details.country %></td>
      </tr>
      <tr>
        <td><strong>Bank:</strong> <%= data.user_details.bank_name %></td>
        <td><strong>Branch:</strong> <%= data.user_details.bank_branch %></td>
      </tr>
      <tr>
        <td><strong>Account No:</strong> <%= data.user_details.bank_account_number %></td>
        <td><strong>IFSC Code:</strong> <%= data.user_details.bank_ifsc_code %></td>
      </tr>
    </table>
  </div>
  <% } %>

  <% if (data.workflow) { %>
  <div class="section">
    <div class="section-title">Approval Workflow</div>
    <% Object.entries(data.workflow).forEach(([stage, steps]) => { %>
      <div class="workflow-stage"><%= stage.replace(/_/g, " ") %></div>
      <table class="timeline-table">
        <tr>
          <th>Role</th>
          <th>User</th>
          <th>Status</th>
          <th>Level</th>
          <th>Approved By</th>
          <th>Current</th>
          <th>Completed</th>
        </tr>
        <% steps.forEach(step => { %>
          <tr>
            <td><%= step.role || "-" %></td>
            <td><%= step.user_name || "-" %></td>
            <td class="status-<%= step.current_status?.toLowerCase() || 'pending' %>">
              <%= step.current_status || "-" %>
            </td>
            <td><%= step.level || "-" %></td>
            <td><%= step.approved_by_name || "-" %></td>
            <td><%= step.current_pointer ? "Yes" : "No" %></td>
            <td><%= step.is_completed ? "Yes" : "No" %></td>
          </tr>
        <% }) %>
      </table>
    <% }) %>
  </div>
  <% } %>

  <% if (data.additional_fields) { %>
  <div class="section">
    <div class="section-title">Additional Fields</div>
    <table>
      <tr><th>Field</th><th>Value</th></tr>
      <% Object.entries(data.additional_fields).forEach(([key, value]) => { %>
        <tr><td><%= key %></td><td><%= value %></td></tr>
      <% }) %>
    </table>
  </div>
  <% } %>

  <div class="footer-note">
    This document was auto-generated. Please verify with HR/Finance in case of discrepancies.
  </div>

</body>
</html>
